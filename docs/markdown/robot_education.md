# PID制御の基本

- ラインの目標値設定
- 当日にカラーセンサーを使って黒と白の輝度値を取得する
- PID制御
  - 光センサーの輝度値：カラーセンサーで反射光の強さを測る
  - 目標の輝度値：ロボットが通りたい道．道は自分たちで決める
  - ズレ：光センサーの輝度値と目標の輝度値の差．目標とした道からどっちにどれだけ離れているか．
  - ステアリングの値：どっちにどれだけ曲がるかを設定する．
  - ゲイン
  - P:ズレが大きいほどステアリングの値を大きくする．ステアリングの強さはゲインで調整
    - $[ステアリング値] = ([光センサーの輝度値] - [目標の輝度値])*[ゲイン]$
    - 滑らかに動く
    - 急カーブは機体がふらつく
    - 安定走行までに時間がかかる
    - 速度をあげると目標にたどり着けないことがある
  - I:ズレを足し合わせた面積が大きほどステアリング値を大きくする(積分)
    - $[ステアリング値] = integral([光センサーの輝度値] - [目標の輝度値])dt*[ゲイン](tは時間)$
    - Pよりも少し遅れてステアリングの値が更新される
    - ゲインを大きくすると急な変化になる
    - Iだけでは目標に戻れなくなる
    - PIとすると急カーブなどで目標に戻れなくなることを防ぐ
  - D:直前のズレと現在のズレの差(ズレの変化)が大きいほどステアリング値を大きくする(微分)
    - $[ステアリング値] = d/dt([光センサーの輝度値] - [目標の輝度値])*[ゲイン](tは時間)$
    - ズレの変化に反応が速い
    - 目標値に近く機能がないため，単体では機能しない
    - 急な変化に対してふらつきをなくすことができる
  - ゲイン調整ポイント
    - Pゲイン，Iゲインは機体が暴れない程度の範囲で大きく
    - Iゲインはとても小さいことが多い(0.001 < I Gain < 0.003)
    - Dゲインは機体が小刻みに震えない程度に大きくする(10<D gain<30)
    - PIDは互いに影響し合うため随時調整が必要

# PWM(Pulse Width Modulation)の役割
[参考1](https://monoist.atmarkit.co.jp/mn/articles/0706/06/news132.html)
[参考2](http://www.sist.ac.jp/club/mcf/Umeta_lecture/PWM.html)

- モータの回転数を制御するのに使う方法
- PWMは一定の時間内でどの程度Highを出力するかをコントロールする制御方式
- ON・OFFを繰り返す周期に対するONの時間の割合を，デューティー比と呼びます．
  - デューティー比が大きいとONの時間が長い
  - デューティー比が$1$だと最大速で前進し$-1$だと最大速で後退する．